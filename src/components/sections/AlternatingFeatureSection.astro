---
import { Icon } from "astro-icon/components";

type Bullet = {
  icon: string;
  title: string;
  text: string;
};

interface Props {
  title: string;
  description?: string;
  bullets: Bullet[];
  ctaText?: string;
  ctaHref?: string;

  mediaType?: "image" | "video" | "embed";

  // image/video
  mediaSrc?: string;
  mediaAlt?: string;

  // embed
  embedSrc?: string;
  embedTitle?: string;

  // "fill" makes the iframe stretch to the beige box (best for the lake widget)
  // "center" centers a smaller embed card inside the beige box
  embedMode?: "center" | "fill" | "scale";

  // used only in "center" mode
  embedAspectRatio?: string;
  embedMaxWidth?: number;

  reverse?: boolean;
}

const {
  title,
  description,
  bullets,
  ctaText,
  ctaHref,

  mediaType = "image",
  mediaSrc = "",
  mediaAlt = "",

  embedSrc = "",
  embedTitle = title,
  embedMode = "center",
  embedAspectRatio = "420 / 380",
  embedMaxWidth = 420,

  reverse = false,
} = Astro.props;
---

<section class={`alt-feature ${reverse ? "alt-feature--reverse" : ""}`}>
  <div class="alt-feature__media">
    {mediaType === "embed" ? (
      <div class={`alt-feature__embed alt-feature__embed--${embedMode}`}>
        {embedMode === "center" ? (
          <div
            class="alt-feature__embed-inner"
            style={`aspect-ratio:${embedAspectRatio}; max-width:${embedMaxWidth}px;`}
          >
            <iframe
              class="alt-feature__embed-el"
              src={embedSrc}
              title={embedTitle}
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            />
          </div>
        ) : (
          <iframe
            class="alt-feature__embed-el"
            src={embedSrc}
            title={embedTitle}
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
          />
        )}
      </div>
    ) : mediaType === "video" ? (
      <video
        class="alt-feature__media-el"
        src={mediaSrc}
        autoplay
        loop
        muted
        playsinline
        preload="metadata"
      />
    ) : (
      <img
        class="alt-feature__media-el"
        src={mediaSrc}
        alt={mediaAlt}
        loading="lazy"
        decoding="async"
      />
    )}
  </div>

  <div class="alt-feature__content">
    <h2 class="alt-feature__title">{title}</h2>
    {description && <p class="alt-feature__desc">{description}</p>}

    <ul class="alt-feature__bullets">
      {bullets.map((b) => (
        <li class="alt-feature__bullet">
          <span class="alt-feature__icon" aria-hidden="true">
            <Icon name={b.icon} width={18} height={18} />
          </span>
          <div class="alt-feature__bullet-text">
            <strong>{b.title}</strong>
            <span>{b.text}</span>
          </div>
        </li>
      ))}
    </ul>

    {ctaText && ctaHref && (
      <a class="alt-feature__cta" href={ctaHref}>
        {ctaText}
      </a>
    )}
  </div>
</section>

<style>
  .alt-feature {
    display: grid;
    grid-template-columns: 1.15fr 0.85fr;
    gap: clamp(1rem, 2vw, 2.25rem);
    align-items: center;
    margin: var(--section-margin) auto;
  }

  .alt-feature--reverse {
    grid-template-columns: 0.85fr 1.15fr;
  }
  .alt-feature--reverse .alt-feature__media {
    order: 2;
  }

  /* ONE height rule shared by image/video/embed so the beige box always matches */
  .alt-feature__media {
    --media-h: clamp(320px, 32vw, 520px);
    height: var(--media-h);

    border-radius: 24px;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.06);
    box-shadow: var(--shadow2);
  }

  /* image/video fill */
  .alt-feature__media-el {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* embed wrapper must fill the media box */
  .alt-feature__embed {
    width: 100%;
    height: 100%;
  }

  /* Center mode: center a “card” inside the beige box */
  .alt-feature__embed--center {
    display: grid;
    place-items: center;
    padding: clamp(0.75rem, 1.4vw, 1.25rem);
    width: 100%;
    height: 100%;
  }

  .alt-feature__embed-inner {
    width: 100%;
    height: 100%;
    max-width: 420px;
    border-radius: 18px;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.04);
  }

  /* Fill mode: iframe fills the entire beige box (best for lake widget) */
  .alt-feature__embed--fill .alt-feature__embed-el {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }

  /* Center mode iframe fills the inner card */
  .alt-feature__embed--center .alt-feature__embed-el {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }

  .alt-feature__content {
    max-width: 52ch;
  }

  .alt-feature__title {
    margin: 0 0 0.65rem 0;
  }

  .alt-feature__desc {
    margin: 0 0 1.1rem 0;
    opacity: 0.9;
  }

  .alt-feature__bullets {
    list-style: none;
    margin: 0;
    padding: 0;
    display: grid;
    gap: 0.85rem;
  }

  .alt-feature__bullet {
    display: grid;
    grid-template-columns: 28px 1fr;
    gap: 0.75rem;
    align-items: start;
  }

  .alt-feature__icon {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    background: rgba(255, 82, 43, 0.10);
  }

  .alt-feature__bullet-text strong {
    display: block;
    line-height: 1.2;
    margin-bottom: 0.15rem;
  }

  .alt-feature__bullet-text span {
    display: block;
    opacity: 0.9;
  }

  .alt-feature__cta {
    display: inline-block;
    margin-top: 1.25rem;
    padding: 0.85rem 1.25rem;
    border-radius: 999px;
    text-decoration: none;
    font-weight: 700;
    background: var(--theme-primary);
    color: var(--theme-on-primary);
    box-shadow: var(--shadow2);
    transition: transform var(--theme-transition), filter var(--theme-transition);
  }

  .alt-feature__cta:hover {
    transform: translateY(-1px);
    filter: brightness(1.03);
  }

  @media (max-width: 900px) {
    .alt-feature,
    .alt-feature--reverse {
      grid-template-columns: 1fr;
    }

    .alt-feature__media {
      order: 0 !important;
      height: clamp(260px, 52vw, 420px);
    }
  }
</style>
