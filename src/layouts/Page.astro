---
import { Header, Button, Footer } from "@components/odyssey-theme";
import Layout from "./Base.astro";
import type { Props as BaseHeadProps } from "../components/head/BaseHead.astro";
import Logo from "../components/Logo.astro";
import settings from "../config/settings";
import { footerLists, footerSocials } from "../config/footer";
import { Icon } from "astro-icon/components"; 

export interface Props {
  seo?: BaseHeadProps;
}

import { nav } from "../config/nav.js";

const { seo } = Astro.props as Props;

const siteOrigin = Astro.site?.origin ?? "https://4wardthinking.github.io";
const repoBase = import.meta.env.BASE_URL; // "/rv-park-site/" on Pages

const navWithBase = nav.map((item) => {
  const clean = String(item.slug ?? "").replace(/^\/+/, "").replace(/\/+$/, "");
  // Home should go to the base root
  const path = clean ? `${repoBase}${clean}/` : `${repoBase}`;
  return {
    ...item,
    slug: new URL(path, siteOrigin).toString(),
  };
});
---

<Layout seo={seo}>
  <Header rightMenu navData={navWithBase} slot="header">
    <a slot="logo" href={import.meta.env.BASE_URL} aria-label="Home">
      <Logo />
	</a>

    <Button
      slot="action-item"
      href="tel:+13273245000"
      class="call-button"
      aria-label="Call (327) 324-5000"
    >
      <Icon name="mdi:phone" class="call-icon" aria-hidden="true" />
      <span class="call-number">(327) 324-5000</span>
    </Button>
  </Header>

  <div id="page">
    <slot />
  </div>

  <Footer
    slot="footer"
    background="var(--theme-surface-1)"
    color="var(--theme-on-surface-1)"
    footerLists={footerLists}
    footerSocials={footerSocials}
    copyrightName={settings.name}
    showPlug={settings.showPlug}
  >
    <Logo slot="logo" />
  </Footer>
</Layout>

<style>
  .call-button {
  display: flex;
  flex-direction: column;
  align-items: center;   /* horizontal centering */
  justify-content: center;
  text-align: center;
  gap: 0.1rem;
}
.call-icon {
  width: 20px;
  height: 20px;
  flex: 0 0 auto;
}
.call-number {
  font-weight: 700;
}
</style>